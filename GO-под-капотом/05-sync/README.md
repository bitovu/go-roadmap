# Go: Примитивы синхронизации

---

## Полный список примитивов синхронизации Go

- atomic — атомарные операции
- mutex / RWMutex — защита памяти
- WaitGroup — ожидание goroutine
- chan — коммуникация
- Once — однократное выполнение
- Cond — ожидание условий

## Идиома Go
> Не делись памятью — делись сообщениями


## atomic
**Назначение:** атомарные операции без блокировок  
**Используется для:** счётчиков, флагов, простых чисел  
**Плюсы:** очень быстро, нет mutex  
**Минусы:** только примитивные типы, сложную логику не покрывает  

Используй, если:
- нужен простой счётчик
- нет сложных структур
- важна производительность

---

## mutex
**Назначение:** защита общей памяти  
**Используется для:** структур, map, слайсов  
**Плюсы:** универсален, понятен  
**Минусы:** возможны дедлоки, медленнее atomic  

Виды:
- `Mutex` — обычная блокировка
- `RWMutex` — много чтений, мало записей

Используй, если:
- есть общие данные
- несколько goroutine пишут/читают
- atomic недостаточно

---

## WaitGroup
**Назначение:** ожидание завершения goroutine  
**Используется для:** параллельных задач  
**Плюсы:** простой и надёжный  
**Минусы:** только ожидание, не для передачи данных  

Важно:
- счётчик увеличивается ДО запуска goroutine
- нельзя копировать
- не управляет ошибками

Используй, если:
- нужно дождаться выполнения задач
- результат не передаётся напрямую

---

## chan (каналы)
**Назначение:** передача данных между goroutine  
**Используется для:** синхронизации и коммуникации  
**Плюсы:** безопасно, идиоматично для Go  
**Минусы:** можно словить дедлок при неправильном использовании  

Типы:
- небуферизированные — строгая синхронизация
- буферизированные — очередь значений

Особенности:
- закрытие канала — сигнал о завершении
- чтение из закрытого канала возможно
- запись в закрытый канал — ошибка

Используй, если:
- goroutine обмениваются данными
- нужна явная модель взаимодействия

---

## Когда что выбирать

- **atomic** — быстрые счётчики и флаги
- **mutex** — защита общей памяти
- **WaitGroup** — дождаться goroutine
- **chan** — передача данных и координация

---

## Once
**Назначение:** выполнить действие ровно один раз  
**Используется для:** инициализации, синглтонов, lazy-init  
**Плюсы:** потокобезопасно, очень просто  
**Минусы:** нельзя «сбросить»  

Особенности:
- гарантирует выполнение только одного раза
- даже при нескольких goroutine
- если функция упала с panic — считается выполненной

Используй, если:
- нужна однократная инициализация
- нельзя допустить повторный запуск

---

## Cond
**Назначение:** ожидание события / условия  
**Используется для:** сложной координации goroutine  
**Плюсы:** гибкость  
**Минусы:** сложен, легко ошибиться  

Особенности:
- работает поверх mutex
- поддерживает ожидание (`Wait`) и уведомление (`Signal`, `Broadcast`)
- редко нужен в обычном Go-коде

Используй, если:
- каналы не подходят
- нужно ждать конкретное условие
- требуется тонкий контроль

---

 ⬅️ [домой,уолтер](../)
