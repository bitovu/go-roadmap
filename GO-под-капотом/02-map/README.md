# Map –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º (Go)

---

## Map –≤ Go ‚Äî –∫—Ä–∞—Ç–∫–æ –¥–ª—è —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è

`map` –≤ Go ‚Äî —ç—Ç–æ **—Ö–µ—à-—Ç–∞–±–ª–∏—Ü–∞**.

–í–Ω—É—Ç—Ä–∏ –æ–Ω–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –º–∞—Å—Å–∏–≤–∞ –±–∞–∫–µ—Ç–æ–≤, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Ö—Ä–∞–Ω–∏—Ç –¥–æ **8 –ø–∞—Ä –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ**.
–ö–ª—é—á —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è: –º–ª–∞–¥—à–∏–µ –±–∏—Ç—ã —Ö–µ—à–∞ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –∏–Ω–¥–µ–∫—Å –±–∞–∫–µ—Ç–∞, –∞ —Å—Ç–∞—Ä—à–∏–µ 8 –±–∏—Ç –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ `tophash` –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞.

**–ö–æ–ª–ª–∏–∑–∏—è** ‚Äî —ç—Ç–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ö–µ—à —É —Ä–∞–∑–Ω—ã—Ö –∫–ª—é—á–µ–π, –∞ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ map —ç—Ç–æ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –ø–æ–ø–∞–¥–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –∫–ª—é—á–µ–π –≤ –æ–¥–∏–Ω –±–∞–∫–µ—Ç.

–ö–æ–≥–¥–∞ —Å—Ä–µ–¥–Ω—è—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥, `map` —Ä–∞—Å—Ç—ë—Ç ‚Äî
—Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –±–∞–∫–µ—Ç–æ–≤, –∞ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è **–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ** —Å –ø–æ–º–æ—â—å—é –º–µ—Ö–∞–Ω–∏–∑–º–∞ —ç–≤–∞–∫—É–∞—Ü–∏–∏ (incremental rehashing).

–û–ø–µ—Ä–∞—Ü–∏–∏ –≤—Å—Ç–∞–≤–∫–∏, –ø–æ–∏—Å–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∑–∞ `O(1)` –≤ —Å—Ä–µ–¥–Ω–µ–º,
–Ω–æ –≤ —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ (–ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∫–æ–ª–ª–∏–∑–∏–π) –≤–æ–∑–º–æ–∂–Ω–∞ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –¥–æ `O(n)`.

`map` –Ω–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞ –∏ —Ç—Ä–µ–±—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ.


---

## –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `map`

–ù–∞ —É—Ä–æ–≤–Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `map` –≤–∫–ª—é—á–∞–µ—Ç:

- –º–∞—Å—Å–∏–≤ –±–∞–∫–µ—Ç–æ–≤
- —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—é (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –∫–ª—é—á–∞)
- —Å—á—ë—Ç—á–∏–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ—Å—Ç–æ–º (`B`, `oldbuckets`, —Å—á—ë—Ç—á–∏–∫ —ç–≤–∞–∫—É–∞—Ü–∏–∏)

–î–∞–Ω–Ω—ã–µ –≤ `map` **–Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ** ‚Äî
–æ–Ω–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –±–∞–∫–µ—Ç–∞–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–µ—à–∞ –∫–ª—é—á–∞.

---

## –ë–∞–∫–µ—Ç—ã (buckets)

–ö–∞–∂–¥—ã–π –±–∞–∫–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:

- –¥–æ **8 –∫–ª—é—á–µ–π**
- —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –º–∞—Å—Å–∏–≤ `tophash` (8 —Å—Ç–∞—Ä—à–∏—Ö –±–∏—Ç —Ö–µ—à–∞ –∫–ª—é—á–∞)
- —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ overflow-–±–∞–∫–µ—Ç (–µ—Å–ª–∏ –±–∞–∫–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω)

–ï—Å–ª–∏ –≤ –æ–¥–Ω–æ–º –±–∞–∫–µ—Ç–µ –±–æ–ª—å—à–µ 8 —ç–ª–µ–º–µ–Ω—Ç–æ–≤,
—Å–æ–∑–¥–∞—ë—Ç—Å—è **overflow-–±–∞–∫–µ—Ç**, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –æ—Å–Ω–æ–≤–Ω—ã–º.

Overflow ‚Äî —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∏ **–Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç —Ä–æ—Å—Ç –≤—Å–µ–π map**.

---

## –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏–ª–∏ –ø–æ–∏—Å–∫–µ —ç–ª–µ–º–µ–Ω—Ç–∞:

1. **–∫–ª—é—á —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è**
2. –º–ª–∞–¥—à–∏–µ –±–∏—Ç—ã —Ö–µ—à–∞ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –∏–Ω–¥–µ–∫—Å –±–∞–∫–µ—Ç–∞
3. `tophash` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –±—ã—Å—Ç—Ä—ã–π —Ñ–∏–ª—å—Ç—Ä –≤–Ω—É—Ç—Ä–∏ –±–∞–∫–µ—Ç–∞
4. –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ `tophash` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π

```go
m := make(map[string]int)
m["go"] = 1
```

## –í–∞–∂–Ω–æ

- —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –∫–ª—é—á**
- –∑–Ω–∞—á–µ–Ω–∏–µ **–Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏**
- —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç **—Ç–∏–ø–∞ –∫–ª—é—á–∞**

---

## –†–æ—Å—Ç map –∏ —ç–≤–∞–∫—É–∞—Ü–∏—è (evacuation)

`map` –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞—Å—Ç–∏, –∫–æ–≥–¥–∞:

- —Å—Ä–µ–¥–Ω—è—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥ (~6.5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ –±–∞–∫–µ—Ç)
- –∏–ª–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ overflow-–±–∞–∫–µ—Ç–æ–≤

### –ü—Ä–∏ —Ä–æ—Å—Ç–µ:

- —Å–æ–∑–¥–∞—ë—Ç—Å—è **–Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤ –±–∞–∫–µ—Ç–æ–≤** (–≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ)
- —Å—Ç–∞—Ä–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ `oldbuckets`
- —ç–ª–µ–º–µ–Ω—Ç—ã **–Ω–µ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è —Å—Ä–∞–∑—É**
- –ø–µ—Ä–µ–Ω–æ—Å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ**, –≤–æ –≤—Ä–µ–º—è –æ–±—ã—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (`get`, `set`, `delete`)

–≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **—ç–≤–∞–∫—É–∞—Ü–∏–µ–π**  
(*incremental rehashing*).

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- –Ω–µ—Ç –¥–æ–ª–≥–∏—Ö –ø–∞—É–∑
- —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
- —Ä–æ—Å—Ç –ø—Ä–æ–∑—Ä–∞—á–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## –ê–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å

–°—Ä–µ–¥–Ω—è—è (–∞–º–æ—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è) —Å–ª–æ–∂–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π:

- —á—Ç–µ–Ω–∏–µ: `O(1)`
- –∑–∞–ø–∏—Å—å: `O(1)`
- —É–¥–∞–ª–µ–Ω–∏–µ: `O(1)`

–í —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ (–º–Ω–æ–≥–æ –∫–æ–ª–ª–∏–∑–∏–π):

`len(map)` —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞ O(1), –ø–æ—Ç–æ–º—É —á—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ–ª–µ `count` –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `hmap`, –∏ `len` –ø—Ä–æ—Å—Ç–æ —á–∏—Ç–∞–µ—Ç —ç—Ç–æ –ø–æ–ª–µ.

- `O(n)`

–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –º–µ—Ö–∞–Ω–∏–∑–º–æ–º `grow`.

## –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ùå map –Ω–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞

- –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å ‚Üí `panic`

- —á—Ç–µ–Ω–∏–µ + –∑–∞–ø–∏—Å—å ‚Üí `panic`

```go
fatal error: concurrent map writes
```

## –†–∞–±–æ—Ç–∞ —Å map –≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π —Å—Ä–µ–¥–µ
–ò—Å–ø–æ–ª—å–∑—É—é—Ç:
- `sync.Mutex`
- `sync.RWMutex`
- `sync.Map` (–¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)

```go
var mu sync.Mutex

mu.Lock()
m[key] = value
mu.Unlock()
```

–ö–æ—Ä–æ—Ç–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞ –¥–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

- map = —Ö–µ—à-—Ç–∞–±–ª–∏—Ü–∞

- –¥–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –≤ –±–∞–∫–µ—Ç–∞—Ö

- –∫–ª—é—á —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è, –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –Ω–µ—Ç

- overflow ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ

- grow ‚Äî —Ä–æ—Å—Ç –≤—Å–µ–π map

- —Ä–æ—Å—Ç —á–µ—Ä–µ–∑ —ç–≤–∞–∫—É–∞—Ü–∏—é

- —Å—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å O(1)

- map –Ω–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞

---


# –ù–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Go `map` (Swiss Table) ‚Äî –ø—Ä–æ—Å—Ç–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

**–ù–∞—á–∏–Ω–∞—è —Å Go 1.24, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ map –±—ã–ª–∞ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ Swiss Table ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—ã —Å –≥—Ä—É–ø–ø–∞–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ SIMD-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏**

–≠—Ç–æ—Ç —Ñ–∞–π–ª ‚Äî **–¢–û–õ–¨–ö–û –ø—Ä–æ –Ω–æ–≤—É—é map**.
–ë–µ–∑ —Å—Ç–∞—Ä—ã—Ö –±–∞–∫–µ—Ç–æ–≤, overflow –∏ `tophash`.

–¶–µ–ª—å: –ø–æ–Ω—è—Ç—å **–∏–¥–µ—é**, –∞ –Ω–µ –∑–∞—É—á–∏—Ç—å —Ü–∏—Ñ—Ä—ã.

---

## 1. –ì–ª–∞–≤–Ω–∞—è –∏–¥–µ—è (–æ–¥–Ω–∏–º –∞–±–∑–∞—Ü–µ–º)

–í –Ω–æ–≤–æ–π Go `map`:

* –∫–ª—é—á —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è –≤ **64-–±–∏—Ç–Ω–æ–µ —á–∏—Å–ª–æ**
* —ç—Ç–æ—Ç —Ö–µ—à **–¥–µ–ª—è—Ç –Ω–∞ –¥–≤–µ —á–∞—Å—Ç–∏**
* –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–µ –≤ –±–∞–∫–µ—Ç–∞—Ö, –∞ –≤ **groups (–≥—Ä—É–ø–ø–∞—Ö)**
* –ø–æ–∏—Å–∫ –¥–µ–ª–∞–µ—Ç—Å—è **–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ** —á–µ—Ä–µ–∑ SIMD ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –º–Ω–æ–≥–æ —è—á–µ–µ–∫

---

## 2. –ß—Ç–æ —Ç–∞–∫–æ–µ group (–≥—Ä—É–ø–ø–∞)

**Group** ‚Äî —ç—Ç–æ –º–∞–ª–µ–Ω—å–∫–∏–π –±–ª–æ–∫ –≤–Ω—É—Ç—Ä–∏ map.

–û–±—ã—á–Ω–æ:

* **1 group = 16 —Å–ª–æ—Ç–æ–≤**
* –∫–∞–∂–¥—ã–π —Å–ª–æ—Ç –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å **1 –∫–ª—é—á + 1 –∑–Ω–∞—á–µ–Ω–∏–µ**

–ú–æ–∂–Ω–æ –¥—É–º–∞—Ç—å —Ç–∞–∫:

> Group ‚Äî —ç—Ç–æ –º–∏–Ω–∏-—Ç–∞–±–ª–∏—Ü–∞ –∏–∑ 16 —è—á–µ–µ–∫.

---

## 3. –ß—Ç–æ —Ç–∞–∫–æ–µ ¬´16 —Å–ª–æ—Ç–æ–≤¬ª –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏

–ü—Ä–µ–¥—Å—Ç–∞–≤—å –∫–æ—Ä–æ–±–∫—É —Å 16 –æ—Ç–¥–µ–ª–µ–Ω–∏—è–º–∏:

```
[ _ ][ _ ][ _ ][ _ ]
[ _ ][ _ ][ _ ][ _ ]
[ _ ][ _ ][ _ ][ _ ]
[ _ ][ _ ][ _ ][ _ ]
```

–ö–∞–∂–¥–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ ‚Äî **–æ–¥–∏–Ω —Å–ª–æ—Ç**:

* –ª–∏–±–æ –ø—É—Å—Ç–æ–π
* –ª–∏–±–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª—é—á –∏ –∑–Ω–∞—á–µ–Ω–∏–µ

---

## 4. –ì–¥–µ —Ç—É—Ç ¬´16 –±–∞–π—Ç¬ª –∏ –ø—Ä–∏ —á—ë–º —Ç—É—Ç SIMD

–£ –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ—Ç–∞ –µ—Å—Ç—å **1 control byte** (1 –±–∞–π—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö).

–î–ª—è –≥—Ä—É–ø–ø—ã:

* 16 —Å–ª–æ—Ç–æ–≤
* –∑–Ω–∞—á–∏—Ç **16 control bytes**

–≠—Ç–∏ 16 –±–∞–π—Ç –ª–µ–∂–∞—Ç **—Ä—è–¥–æ–º –≤ –ø–∞–º—è—Ç–∏**.

CPU —É–º–µ–µ—Ç:

> —Å—Ä–∞–≤–Ω–∏—Ç—å **16 –±–∞–π—Ç –∑–∞ –æ–¥–Ω—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é** (SIMD)

–≠—Ç–æ –∫–ª—é—á–µ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è.

---

## 5. –•–µ—à –∫–ª—é—á–∞: –æ—Ç–∫—É–¥–∞ 64 –±–∏—Ç–∞

–ö–æ–≥–¥–∞ —Ç—ã –∫–ª–∞–¥—ë—à—å –∫–ª—é—á –≤ map:

```
key ‚Üí hash (64 –±–∏—Ç–∞)
```

64 –±–∏—Ç–∞ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ.

–ü—Ä–∏–º–µ—Ä (—É—Å–ª–æ–≤–Ω–æ):

```
10110110 01101001 ... (–≤—Å–µ–≥–æ 64 –±–∏—Ç–∞)
```

---

## 6. –ó–∞—á–µ–º –¥–µ–ª–∏—Ç—å —Ö–µ—à –Ω–∞ 57 –∏ 7 –±–∏—Ç

–•–µ—à –¥–µ–ª—è—Ç **–¥–ª—è –¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á**:

### üîπ –°—Ç–∞—Ä—à–∏–µ ~57 –±–∏—Ç

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è:

* –≤—ã–±–æ—Ä–∞ **–Ω–∞—á–∞–ª—å–Ω–æ–π group**
* –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Ç–∞–±–ª–∏—Ü–µ

–ü—Ä–æ—â–µ:

> –≠—Ç–∏ –±–∏—Ç—ã –≥–æ–≤–æ—Ä—è—Ç, **–≤ –∫–∞–∫—É—é –≥—Ä—É–ø–ø—É –∏–¥—Ç–∏**.

---

### üîπ –ú–ª–∞–¥—à–∏–µ 7 –±–∏—Ç

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ **fingerprint**.

–ü—Ä–æ—â–µ:

> –≠—Ç–æ –∫–æ—Ä–æ—Ç–∫–∏–π "–æ—Ç–ø–µ—á–∞—Ç–æ–∫" –∫–ª—é—á–∞.

–≠—Ç–æ—Ç fingerprint:

* –∫–ª–∞–¥—ë—Ç—Å—è –≤ control byte
* –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

---

## 7. –ß—Ç–æ —Ç–∞–∫–æ–µ fingerprint –Ω–∞ –ø–∞–ª—å—Ü–∞—Ö

Fingerprint = **–±—ã—Å—Ç—Ä—ã–π —Ñ–∏–ª—å—Ç—Ä**.

–í–º–µ—Å—Ç–æ:

> —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∫–ª—é—á —Ü–µ–ª–∏–∫–æ–º

Go —Å–Ω–∞—á–∞–ª–∞:

> —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ 7 –±–∏—Ç

–ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–ª–æ ‚Äî –∫–ª—é—á **—Ç–æ—á–Ω–æ –Ω–µ —Ç–æ—Ç**.

---

## 8. –ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–∏—Å–∫ (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ)

–ü–æ–∏—Å–∫ `get(key)`:

1. –∫–ª—é—á —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è ‚Üí 64 –±–∏—Ç–∞
2. —Å—Ç–∞—Ä—à–∏–µ 57 –±–∏—Ç ‚Üí –≤—ã–±–∏—Ä–∞–µ–º group
3. –º–ª–∞–¥—à–∏–µ 7 –±–∏—Ç ‚Üí fingerprint
4. –∑–∞–≥—Ä—É–∂–∞–µ–º **16 control bytes**
5. SIMD —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç fingerprint —Å–æ –≤—Å–µ–º–∏ 16 —Å–ª–æ—Ç–∞–º–∏
6. –ø–æ–ª—É—á–∞–µ–º –º–∞—Å–∫—É, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0
```

7. `1` = *–≤–æ—Ç —Ç—É—Ç –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞—à –∫–ª—é—á*
8. —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º **—Ä–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á** —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–∏—Ö —Å–ª–æ—Ç–∞—Ö

---

## 9. –ü–æ—á–µ–º—É —ç—Ç–æ –±—ã—Å—Ç—Ä–µ–µ —Å—Ç–∞—Ä—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤

* —Å—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è 16 —Å–ª–æ—Ç–æ–≤
* –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ 1 cache line
* –ø–æ—á—Ç–∏ –Ω–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ —É–∫–∞–∑–∞—Ç–µ–ª—è–º
* –º–∏–Ω–∏–º—É–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –∫–ª—é—á–µ–π

–ü–æ–∏—Å–∫ –æ–±—ã—á–Ω–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è **–≤ –æ–¥–Ω–æ–π group**.

---

## 10. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∫–æ–ª–ª–∏–∑–∏–∏

–ï—Å–ª–∏ –≤ –≥—Ä—É–ø–ø–µ –Ω–µ—Ç –º–µ—Å—Ç–∞ –∏–ª–∏ –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω:

* map –∏–¥—ë—Ç –≤ **—Å–ª–µ–¥—É—é—â—É—é group** (probing)
* —Å–Ω–æ–≤–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç 16 —Å–ª–æ—Ç–æ–≤ SIMD-–æ–º

–í–∞–∂–Ω–æ:

* ‚ùå –Ω–µ—Ç overflow-–±–∞–∫–µ—Ç–æ–≤
* ‚ùå –Ω–µ—Ç —Ü–µ–ø–æ—á–µ–∫
* ‚úÖ –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–∞—Å—Å–∏–≤–µ

---

## 11. Grow (resize) –≤ –Ω–æ–≤–æ–π map

Grow –æ–∑–Ω–∞—á–∞–µ—Ç:

* —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞
* —ç–ª–µ–º–µ–Ω—Ç—ã **–ø–µ—Ä–µ—Ö–µ—à–∏—Ä—É—é—Ç—Å—è**
* —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –Ω–æ–≤—ã–º –≥—Ä—É–ø–ø–∞–º

–¶–µ–ª—å:

* —É–º–µ–Ω—å—à–∏—Ç—å probing
* —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å O(1) –≤ —Å—Ä–µ–¥–Ω–µ–º

---

## 12. –ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ –∑–∞—É—á–∏–≤–∞—Ç—å

–ù–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–π—Å—è –Ω–∞:

* —Ç–æ—á–Ω—ã—Ö —á–∏—Å–ª–∞—Ö (57, 7, 16)
* SIMD-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö

–í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å:

> —Ö–µ—à ‚Üí group ‚Üí fingerprint ‚Üí SIMD ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–∞

---

## 13. –ö–∞–∫ —ç—Ç–æ —Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏

> –í –Ω–æ–≤–æ–π Go map –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Swiss Table: —Ö–µ—à –∫–ª—é—á–∞ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –¥–≤–µ —á–∞—Å—Ç–∏ ‚Äî –æ–¥–Ω–∞ –≤—ã–±–∏—Ä–∞–µ—Ç –≥—Ä—É–ø–ø—É, –¥—Ä—É–≥–∞—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ –∫–æ—Ä–æ—Ç–∫–∏–π fingerprint, –∏ –ø–æ–∏—Å–∫ —É—Å–∫–æ—Ä—è–µ—Ç—Å—è SIMD-–ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–ª–æ—Ç–æ–≤.

---

## 14. –ö–æ—Ä–æ—Ç–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞ –¥–ª—è –≥–æ–ª–æ–≤—ã

```
64-bit hash
‚Üí group index (‚âà57 bits)
‚Üí fingerprint (7 bits)
‚Üí SIMD over 16 slots
```

---

## 15. –ì–ª–∞–≤–Ω–æ–µ

* group = –±–ª–æ–∫ –∏–∑ 16 —Å–ª–æ—Ç–æ–≤
* 7 –±–∏—Ç = –±—ã—Å—Ç—Ä—ã–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫ –∫–ª—é—á–∞
* SIMD = —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–∞—á–∫–æ–π
* —Ü–µ–ª—å = —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –∫—ç—à

---

  ‚¨ÖÔ∏è [–¥–æ–º–æ–π,—É–æ–ª—Ç–µ—Ä](../)
  
