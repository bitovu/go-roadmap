# Fan-out / Fan-in pattern

← [К списку паттернов](README.md)

## Коротко для собеседования

**Fan-out / Fan-in** — это паттерн конкурентности,
при котором входной поток данных распределяется
между несколькими воркерами (**fan-out**),
а результаты их работы собираются обратно
в один выходной поток (**fan-in**).

Fan-out выполняет работу, fan-in только собирает результаты.

---

## Когда использовать

- одна функция обработки
- данные независимы друг от друга
- требуется параллельное выполнение
- есть CPU или I/O нагрузка

---

## Когда НЕ использовать

- несколько последовательных этапов обработки (лучше pipeline)
- сложные зависимости между задачами
- когда достаточно обычного worker pool

---

## Схема

    input
      |
   fan-out
  /   |   \
worker worker worker
  \   |   /
    fan-in
      |
     out

         
## Минимальный пример (идея)

```go
for i := 0; i < n; i++ {
	go worker(in, out)
}
```

---

# Ключевые правила

- все воркеры читают из одного входного канала

- каждый воркер выполняет функцию обработки

- fan-in не выполняет вычислений

- выходной канал закрывается после завершения всех воркеров

# Типичные ошибки

- fan-in выполняет бизнес-логику

- забыли закрыть выходной канал

- утечка goroutine при раннем выходе




