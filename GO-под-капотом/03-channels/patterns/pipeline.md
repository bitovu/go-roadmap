# Pipeline pattern

← [К списку паттернов](README.md)

## Коротко для собеседования

**Pipeline** — это паттерн конкурентности,
при котором данные проходят через цепочку этапов,
каждый из которых работает в отдельной goroutine
и связан с другими этапами через каналы.

Каждый этап:
- работает в своей goroutine
- читает данные из входного канала
- обрабатывает их
- пишет в выходной канал

Данные последовательно проходят через все этапы.

---

## Когда использовать

- несколько последовательных шагов обработки
- поток данных
- каждый шаг можно изолировать логически

---

## Когда НЕ использовать

- один шаг обработки
- нет потока данных
- простая параллельная очередь (лучше worker pool)

---

## Схема
```
source → stage1 → stage2 → stage3 → sink
```

# Минимальный пример

```go
func stage(in <-chan int) <-chan int {
	out := make(chan int)
	go func() {
		for v := range in {
			out <- v * 2
		}
		close(out)
	}()
	return out
}
```

---

# Ключевые правила

- этап закрывает только свой выходной канал

- входной канал никогда не закрывается внутри этапа

- каждый этап — отдельная goroutine

---

# Типичные ошибки

- закрытие входного канала

- забыли close(out)

- запуск нескольких goroutine внутри одного этапа без надобности
